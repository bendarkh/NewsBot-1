<?php
/**
 * Haber Kategorilendirici sƒ±nƒ±fƒ± - Her kategori i√ßin farklƒ± i√ßerikler
 */

if (!defined('ABSPATH')) {
    exit;
}

class NewsBot_News_Categorizer {
    
    private $categories;
    
    public function __construct() {
        $this->init_categories();
        add_action('wp_ajax_newsbot_get_categorized_news', array($this, 'get_categorized_news'));
        add_action('wp_ajax_newsbot_refresh_category', array($this, 'refresh_category_news'));
    }
    
    /**
     * Kategorileri ba≈ülat
     */
    private function init_categories() {
        $this->categories = array(
            'yapay_zeka' => array(
                'name' => 'Yapay Zeka',
                'icon' => 'ü§ñ',
                'color' => '#3B82F6',
                'news' => array(
                    'ChatGPT-4 Turbo Yeni √ñzelliklerle G√ºncellendi',
                    'Google Gemini Ultra Performans Testleri ≈ûa≈üƒ±rttƒ±',
                    'Microsoft Copilot Enterprise S√ºr√ºm√º Duyuruldu',
                    'OpenAI Sora Video √úretim AI\'sƒ± Beta\'da',
                    'Meta AI Llama 3 Modeli A√ßƒ±k Kaynak Oldu',
                    'Anthropic Claude 3 Opus Rekora Ko≈üuyor',
                    'Midjourney V6 Ger√ßek√ßilik Seviyesini Artƒ±rdƒ±',
                    'Stability AI Video √úretimde √áƒ±ƒüƒ±r A√ßtƒ±',
                    'Perplexity AI Arama Motoru √ñzelliƒüi Ekledi',
                    'Character.AI Sesli Sohbet √ñzelliƒüi Getirdi'
                )
            ),
            'blockchain' => array(
                'name' => 'Blockchain & Kripto',
                'icon' => '‚Çø',
                'color' => '#F59E0B',
                'news' => array(
                    'Bitcoin ETF Onaylarƒ± Piyasayƒ± Hareketlendirdi',
                    'Ethereum Shanghai G√ºncellemesi Tamamlandƒ±',
                    'Solana Aƒüƒ±nda ƒ∞≈ülem Hacmi Rekor Kƒ±rdƒ±',
                    'Polygon zkEVM Ana Aƒüa Ge√ßti',
                    'Cardano Chang Hard Fork Tarihi A√ßƒ±klandƒ±',
                    'Avalanche Subnet Teknolojisi Yaygƒ±nla≈üƒ±yor',
                    'Chainlink CCIP K√∂pr√º Protokol√º Aktif',
                    'Uniswap V4 Hook Sistemi Devrim Yaratacak',
                    'Aave V3 Yeni Zincir Entegrasyonlarƒ±',
                    'The Graph Subgraph Studio G√ºncellendi'
                )
            ),
            'mobil' => array(
                'name' => 'Mobil Teknoloji',
                'icon' => 'üì±',
                'color' => '#10B981',
                'news' => array(
                    'iPhone 16 Pro Max Kamera √ñzellikleri Sƒ±zdƒ±',
                    'Samsung Galaxy S25 Ultra Tasarƒ±m Deƒüi≈üikliƒüi',
                    'Google Pixel 9 AI √ñzellikler Paketi',
                    'Xiaomi 15 Pro Snapdragon 8 Gen 4 ile Geliyor',
                    'OnePlus 13 Hƒ±zlƒ± ≈ûarj Teknolojisi Rekoru',
                    'Huawei Mate 70 HarmonyOS NEXT ile',
                    'Oppo Find X8 Periskop Kamera Sistemi',
                    'Vivo X200 Pro Zeiss Ortaklƒ±ƒüƒ± Devam',
                    'Realme GT 7 Pro Gaming Performansƒ±',
                    'Nothing Phone 3 ≈ûeffaf Tasarƒ±m Yeniliƒüi'
                )
            ),
            'oyun' => array(
                'name' => 'Oyun Teknolojisi',
                'icon' => 'üéÆ',
                'color' => '#8B5CF6',
                'news' => array(
                    'PlayStation 6 Geli≈ütirme Kiti Sƒ±zdƒ±rƒ±ldƒ±',
                    'Xbox Series X Pro S√∂ylentileri G√º√ßleniyor',
                    'Nintendo Switch 2 OLED Ekran Detaylarƒ±',
                    'Steam Deck OLED 2 Performans Artƒ±≈üƒ±',
                    'ASUS ROG Ally X Handheld Konsol Duyuru',
                    'Meta Quest 4 VR G√∂zl√ºk √ñzellikleri',
                    'Apple Vision Pro Gaming Desteƒüi Geni≈üliyor',
                    'NVIDIA RTX 5090 Oyun Performans Testleri',
                    'AMD RDNA 4 GPU Mimarisi Detaylarƒ±',
                    'Intel Arc B580 Orta Segment GPU Lansmanƒ±'
                )
            ),
            'siber_guvenlik' => array(
                'name' => 'Siber G√ºvenlik',
                'icon' => 'üîí',
                'color' => '#EF4444',
                'news' => array(
                    'Microsoft Exchange Zero-Day A√ßƒ±ƒüƒ± Ke≈üfedildi',
                    'Chrome 131 Kritik G√ºvenlik G√ºncellemesi',
                    'LastPass Veri Sƒ±zƒ±ntƒ±sƒ± Soru≈üturmasƒ± Devam',
                    'Kaspersky Antivirus ABD Yasaƒüƒ± Kararƒ±',
                    'CrowdStrike Falcon Sensor G√ºncelleme Sorunu',
                    'Fortinet FortiGate G√ºvenlik Duvarƒ± A√ßƒ±ƒüƒ±',
                    'Palo Alto Networks PAN-OS G√ºvenlik Yamasƒ±',
                    'Cisco IOS XE Backdoor Saldƒ±rƒ±sƒ± Tespit',
                    'VMware vCenter Server RCE A√ßƒ±ƒüƒ± Uyarƒ±sƒ±',
                    'SolarWinds Orion Platform G√ºvenlik G√ºncellemesi'
                )
            ),
            'startup' => array(
                'name' => 'Startup & Fintech',
                'icon' => 'üöÄ',
                'color' => '#06B6D4',
                'news' => array(
                    'T√ºrk Fintech Startup\'ƒ± 100M$ Yatƒ±rƒ±m Aldƒ±',
                    'Klarna IPO Hazƒ±rlƒ±klarƒ± Hƒ±zlandƒ±',
                    'Stripe Kripto Para √ñdeme Desteƒüi Ekledi',
                    'Revolut Bankacƒ±lƒ±k Lisansƒ± Aldƒ±',
                    'Wise Para Transfer √úcretlerini D√º≈ü√ºrd√º',
                    'PayPal Stablecoin PYUSD Lansmanƒ±',
                    'Square Block Bitcoin Mining Yatƒ±rƒ±mƒ±',
                    'Robinhood Kripto Wallet √ñzelliƒüi Aktif',
                    'Coinbase Base L2 Aƒüƒ± B√ºy√ºyor',
                    'Binance T√ºrkiye Operasyonlarƒ± Geni≈üliyor'
                )
            ),
            'bilim' => array(
                'name' => 'Bilim & Ara≈ütƒ±rma',
                'icon' => 'üî¨',
                'color' => '#84CC16',
                'news' => array(
                    'CERN LHC Yeni Par√ßacƒ±k Ke≈üfi A√ßƒ±klamasƒ±',
                    'NASA Artemis 3 Ay Misyonu G√ºncellemesi',
                    'SpaceX Starship IFT-6 Test U√ßu≈üu Ba≈üarƒ±lƒ±',
                    'James Webb Teleskop Yeni Galaksi Ke≈üfi',
                    'MIT Quantum Bilgisayar √áƒ±ƒüƒ±r A√ßan Geli≈üme',
                    'Google Quantum Supremacy Yeni Rekor',
                    'TSMC 2nm √áip √úretim Teknolojisi Hazƒ±r',
                    'Intel 18A Process Node Geli≈ütirme S√ºreci',
                    'Samsung 3nm GAA Teknolojisi Yaygƒ±nla≈üƒ±yor',
                    'ASML EUV Lithography Yeni Nesil Makineler'
                )
            ),
            'sosyal_medya' => array(
                'name' => 'Sosyal Medya',
                'icon' => 'üì≤',
                'color' => '#EC4899',
                'news' => array(
                    'Instagram Threads Kullanƒ±cƒ± Sayƒ±sƒ± 200M\'yi A≈ütƒ±',
                    'X (Twitter) Premium+ Abonelik Modeli Duyuru',
                    'TikTok Shop E-ticaret Entegrasyonu Geni≈üliyor',
                    'YouTube Shorts Monetizasyon Se√ßenekleri',
                    'LinkedIn AI Destekli ƒ∞√ßerik √ñnerileri',
                    'Facebook Meta AI Chatbot Entegrasyonu',
                    'Snapchat AR Lens Studio G√ºncellendi',
                    'Discord Nitro Yeni √ñzellikler Paketi',
                    'Telegram Premium Abonelik Artƒ±≈üƒ±',
                    'WhatsApp Business API Yeni √ñzellikler'
                )
            )
        );
    }
    
    /**
     * Kategorilere g√∂re haberleri getir
     */
    public function get_categorized_news() {
        check_ajax_referer('newsbot_nonce', 'nonce');
        
        $category = sanitize_text_field($_POST['category']);
        $limit = intval($_POST['limit']) ?: 10;
        
        if (!isset($this->categories[$category])) {
            wp_send_json_error('Ge√ßersiz kategori');
        }
        
        $news = $this->fetch_category_news($category, $limit);
        
        wp_send_json_success($news);
    }
    
    /**
     * Kategori haberlerini yenile
     */
    public function refresh_category_news() {
        check_ajax_referer('newsbot_nonce', 'nonce');
        
        $category = sanitize_text_field($_POST['category']);
        
        if (!isset($this->categories[$category])) {
            wp_send_json_error('Ge√ßersiz kategori');
        }
        
        $news = $this->fetch_category_news($category, 15);
        
        wp_send_json_success($news);
    }
    
    /**
     * Kategori haberlerini √ßek
     */
    private function fetch_category_news($category, $limit) {
        $category_data = $this->categories[$category];
        $news_titles = $category_data['news'];
        
        $news = array();
        $sources = array('TechCrunch', 'The Verge', 'Wired', 'Ars Technica', 'Engadget', 'ZDNet');
        
        // Haberleri karƒ±≈ütƒ±r ve sƒ±nƒ±rla
        shuffle($news_titles);
        $selected_titles = array_slice($news_titles, 0, $limit);
        
        foreach ($selected_titles as $index => $title) {
            $news[] = array(
                'id' => uniqid($category . '_'),
                'title' => $title,
                'source' => $sources[array_rand($sources)],
                'url' => 'https://example.com/news/' . $category . '/' . $index,
                'published_at' => date('Y-m-d H:i:s', strtotime('-' . rand(1, 48) . ' hours')),
                'summary' => $this->generate_news_summary($title, $category),
                'category' => $category_data['name'],
                'reading_time' => rand(2, 8) . ' dk',
                'engagement_score' => rand(60, 95),
                'keywords' => $this->extract_keywords_from_title($title)
            );
        }
        
        return $news;
    }
    
    /**
     * Haber √∂zeti olu≈ütur
     */
    private function generate_news_summary($title, $category) {
        $summaries = array(
            'yapay_zeka' => array(
                'AI teknolojisinde ya≈üanan bu geli≈üme, sekt√∂rde b√ºy√ºk yankƒ± uyandƒ±rdƒ±.',
                'Makine √∂ƒürenmesi alanƒ±ndaki bu yenilik, kullanƒ±cƒ± deneyimini deƒüi≈ütirecek.',
                'Yapay zeka modellerinde kaydedilen bu ilerleme, rekabeti kƒ±zƒ±≈ütƒ±racak.',
                'Deep learning teknolojisindeki bu atƒ±lƒ±m, yeni fƒ±rsatlar yaratƒ±yor.'
            ),
            'blockchain' => array(
                'Blockchain ekosistemindeki bu geli≈üme, yatƒ±rƒ±mcƒ±larƒ± heyecanlandƒ±rdƒ±.',
                'Kripto para piyasasƒ±nda ya≈üanan bu hareket, analisti ≈üa≈üƒ±rttƒ±.',
                'DeFi protokollerindeki bu yenilik, likidite havuzlarƒ±nƒ± etkileyecek.',
                'Web3 teknolojisindeki bu adƒ±m, merkeziyetsizliƒüi g√º√ßlendiriyor.'
            ),
            'mobil' => array(
                'Mobil teknolojide ya≈üanan bu geli≈üme, kullanƒ±cƒ± beklentilerini artƒ±rdƒ±.',
                'Smartphone pazarƒ±ndaki bu yenilik, rekabeti yeniden ≈üekillendirecek.',
                'Mobil i≈ülemci teknolojisindeki bu atƒ±lƒ±m, performans sƒ±nƒ±rlarƒ±nƒ± zorluyor.',
                'Kamera teknolojisindeki bu geli≈üme, fotoƒüraf√ßƒ±lƒ±ƒüƒ± deƒüi≈ütirecek.'
            ),
            'oyun' => array(
                'Gaming end√ºstrisindeki bu geli≈üme, oyuncularƒ± heyecanlandƒ±rdƒ±.',
                'Konsol pazarƒ±ndaki bu yenilik, next-gen deneyimi tanƒ±mlayacak.',
                'GPU teknolojisindeki bu atƒ±lƒ±m, grafik kalitesini artƒ±racak.',
                'VR gaming alanƒ±ndaki bu adƒ±m, immersive deneyimi g√º√ßlendiriyor.'
            ),
            'siber_guvenlik' => array(
                'Siber g√ºvenlik alanƒ±ndaki bu geli≈üme, uzmanlarƒ± endi≈üelendirdi.',
                'G√ºvenlik a√ßƒ±ƒüƒ± konusundaki bu ke≈üif, acil √∂nlem gerektiriyor.',
                'Malware teknolojisindeki bu evrim, savunma stratejilerini zorluyor.',
                'Veri koruma alanƒ±ndaki bu yenilik, privacy standartlarƒ±nƒ± artƒ±rƒ±yor.'
            ),
            'startup' => array(
                'Startup ekosistemindeki bu geli≈üme, giri≈üimcileri umutlandƒ±rdƒ±.',
                'Fintech sekt√∂r√ºndeki bu yenilik, finansal hizmetleri d√∂n√º≈üt√ºrecek.',
                'Venture capital piyasasƒ±ndaki bu hareket, yatƒ±rƒ±m trendlerini belirliyor.',
                'Teknoloji giri≈üimlerindeki bu ba≈üarƒ±, sekt√∂re ilham veriyor.'
            ),
            'bilim' => array(
                'Bilimsel ara≈ütƒ±rmadaki bu ke≈üif, akademik d√ºnyayƒ± heyecanlandƒ±rdƒ±.',
                'Teknoloji geli≈ütirmedeki bu atƒ±lƒ±m, end√ºstriyel uygulamalarƒ± etkileyecek.',
                'Quantum teknolojisindeki bu ilerleme, hesaplama g√ºc√ºn√º devrimle≈ütirecek.',
                'Uzay teknolojisindeki bu ba≈üarƒ±, ke≈üif misyonlarƒ±nƒ± hƒ±zlandƒ±racak.'
            ),
            'sosyal_medya' => array(
                'Sosyal medya platformundaki bu yenilik, kullanƒ±cƒ± etkile≈üimini artƒ±racak.',
                'ƒ∞√ßerik √ºretimi alanƒ±ndaki bu geli≈üme, creator ekonomisini etkileyecek.',
                'Platform algoritmasƒ±ndaki bu deƒüi≈üiklik, reach oranlarƒ±nƒ± deƒüi≈ütirecek.',
                'Sosyal ticaret alanƒ±ndaki bu adƒ±m, e-commerce\'i d√∂n√º≈üt√ºr√ºyor.'
            )
        );
        
        $category_summaries = isset($summaries[$category]) ? $summaries[$category] : $summaries['yapay_zeka'];
        return $category_summaries[array_rand($category_summaries)];
    }
    
    /**
     * Ba≈ülƒ±ktan anahtar kelime √ßƒ±kar
     */
    private function extract_keywords_from_title($title) {
        $keywords = array();
        $words = explode(' ', strtolower($title));
        
        foreach ($words as $word) {
            $word = trim($word, '.,!?;:"()[]{}');
            if (strlen($word) > 3) {
                $keywords[] = $word;
            }
        }
        
        return array_slice($keywords, 0, 3);
    }
    
    /**
     * T√ºm kategorileri getir
     */
    public function get_all_categories() {
        return $this->categories;
    }
}
?>